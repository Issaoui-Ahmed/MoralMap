"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[846],{846:(e,t,n)=>{let o;n.r(t),n.d(t,{default:()=>W});var r=n(5155),l=n(2115);function i(e,t){return Object.freeze({...e,...t})}let s=(0,l.createContext)(null);function a(){let e=(0,l.use)(s);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}var u=n(5027),c=n.n(u);let d=(0,l.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:o,className:r,id:i,placeholder:a,style:c,whenReady:d,zoom:f,...p},h){let[m]=(0,l.useState)({className:r,id:i,style:c}),[x,g]=(0,l.useState)(null),b=(0,l.useRef)(void 0);(0,l.useImperativeHandle)(h,()=>x?.map??null,[x]);let y=(0,l.useCallback)(o=>{if(null!==o&&!b.current){let r=new u.Map(o,p);b.current=r,null!=n&&null!=f?r.setView(n,f):null!=e&&r.fitBounds(e,t),null!=d&&r.whenReady(d),g(Object.freeze({__version:1,map:r}))}},[]);(0,l.useEffect)(()=>()=>{x?.map.remove()},[x]);let v=x?l.createElement(s,{value:x},o):a??null;return l.createElement("div",{...m,ref:y},v)});function f(e){return(0,l.forwardRef)(function(t,n){let{instance:o,context:r}=e(t).current;(0,l.useImperativeHandle)(n,()=>o);let{children:i}=t;return null==i?null:l.createElement(s,{value:r},i)})}function p(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function h(e,t){return null==t?function(t,n){let o=(0,l.useRef)(void 0);return o.current||(o.current=e(t,n)),o}:function(n,o){let r=(0,l.useRef)(void 0);r.current||(r.current=e(n,o));let i=(0,l.useRef)(n),{instance:s}=r.current;return(0,l.useEffect)(function(){i.current!==n&&(t(s,n,i.current),i.current=n)},[s,n,t]),r}}function m(e,t){let n=(0,l.useRef)(void 0);(0,l.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function x(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function g(e,t){(0,l.useEffect)(function(){return(t.layerContainer??t.map).addLayer(e.instance),function(){t.layerContainer?.removeLayer(e.instance),t.map.removeLayer(e.instance)}},[t,e])}function b(e){return function(t){let n=a(),o=e(x(t,n),n);return!function(e,t){let n=(0,l.useRef)(t);(0,l.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}(n.map,t.attribution),m(o.current,t.eventHandlers),g(o.current,n),o}}n(7650);let y=function(e,t){var n;return n=b(h(e,t)),(0,l.forwardRef)(function(e,t){let{instance:o}=n(e).current;return(0,l.useImperativeHandle)(t,()=>o),null})}(function({url:e,...t},n){return p(new u.TileLayer(e,x(t,n)),n)},function(e,t,n){let{opacity:o,zIndex:r}=t;null!=o&&o!==n.opacity&&e.setOpacity(o),null!=r&&r!==n.zIndex&&e.setZIndex(r);let{url:l}=t;null!=l&&l!==n.url&&e.setUrl(l)}),v=f(b(h(function({position:e,...t},n){let o=new u.Marker(e,t);return p(o,i(n,{overlayContainer:o}))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())}))),j=function(e,t){var n;return f((n=h(e,t),function(e){let t=a(),o=n(x(e,t),t);m(o.current,e.eventHandlers),g(o.current,t);var r=o.current;let i=(0,l.useRef)(void 0);return(0,l.useEffect)(function(){if(e.pathOptions!==i.current){let t=e.pathOptions??{};r.instance.setStyle(t),i.current=t}},[r,e]),o}))}(function({positions:e,...t},n){let o=new u.Polyline(e,t);return p(o,i(n,{overlayContainer:o}))},function(e,t,n){t.positions!==n.positions&&e.setLatLngs(t.positions)});n(5902);let w=(e,t)=>c().divIcon({className:"",iconSize:[40,40],iconAnchor:[20,40],html:'\n      <svg width="40" height="40" viewBox="0 0 24 24">\n        <path fill="'.concat(e,'" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>\n        <text x="12" y="16" text-anchor="middle" font-size="10" font-family="Arial" font-weight="bold" fill="#fff">').concat(t,"</text>\n      </svg>\n    ")}),C=w("#34A853","S"),S=w("#EA4335","E"),k=e=>{let{from:t,to:n,middle:o,totalTimeMinutes:i,defaultTimeMinutes:s,selectedLabel:u,setSelectedLabel:d,consentGiven:f,setMapPoints:p,setRoutes:h,scenarioLabel:m}=e,x=a().map,[g,b]=(0,l.useState)([]),y=(0,l.useRef)([]);return(0,l.useEffect)(()=>{if(!x||!t||!n)return;let e=[[c().latLng(t[0],t[1]),c().latLng(n[0],n[1])],[c().latLng(t[0],t[1]),c().latLng(o[0],o[1]),c().latLng(n[0],n[1])]],r=[s,i],l=[],a=[];return e.forEach((t,n)=>{let o=c().Routing.control({waypoints:t,routeWhileDragging:!1,draggableWaypoints:!1,addWaypoints:!1,show:!1,fitSelectedRoutes:!1,createMarker:()=>null,lineOptions:{styles:[]}}).addTo(x);o.on("routesfound",t=>{var o;let l=t.routes[0].coordinates.map(e=>[e.lat,e.lng]);if(a[n]={coords:l,totalTimeMinutes:null!=(o=r[n])?o:0},a.filter(Boolean).length===e.length){b([...a]);let e=a.flatMap(e=>(null==e?void 0:e.coords)?e.coords:[]);if(e.length){let t=c().latLngBounds(e);x.fitBounds(t,{padding:[50,50],maxZoom:15,animate:!1})}}}),l.push(o)}),()=>{l.forEach(e=>{e.off(),e.getRouter&&"function"==typeof e.getRouter().abort&&e.getRouter().abort(),x.removeControl(e)}),b([])}},[x,t,n,o,i,s]),(0,l.useEffect)(()=>{if(!x||!f)return;let e=()=>{p(g.map(e=>{if(!(null==e?void 0:e.coords))return null;let t=e.coords[Math.floor(e.coords.length/2)],n=x.latLngToContainerPoint(c().latLng(t[0],t[1]));return{x:n.x,y:n.y}})),h(g)};return x.on("move",e),x.on("zoom",e),e(),()=>{x.off("move",e),x.off("zoom",e)}},[x,g,f,p,h]),(0,l.useEffect)(()=>{let e=+("default"!==u),t=()=>{let t=y.current[e];(null==t?void 0:t.bringToFront)&&t.bringToFront()};window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,0)},[u,g]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(v,{position:t,icon:C}),(0,r.jsx)(v,{position:n,icon:S}),g.map((e,t)=>(null==e?void 0:e.coords)?(0,r.jsx)(j,{positions:e.coords,pathOptions:{color:"default"===u&&0===t||"default"!==u&&1===t?"#1452EE":"#BCCEFB",weight:"default"===u&&0===t||"default"!==u&&1===t?7:5,opacity:1},eventHandlers:{click:()=>d(0===t?"default":m)},ref:e=>{e&&(y.current[t]=e)}},t):null)]})},E=e=>{let{mapPoints:t,routes:n}=e;return(0,r.jsx)(r.Fragment,{children:t.map((e,t)=>{let o=n[t];return e&&(null==o?void 0:o.totalTimeMinutes)!=null?(0,r.jsxs)("div",{style:{position:"absolute",left:e.x,top:e.y,transform:"translate(-50%, -100%)",pointerEvents:"none",fontFamily:"Roboto, sans-serif",fontSize:"13px",color:"#202124"},children:[(0,r.jsxs)("div",{style:{background:"#fff",borderRadius:"4px",padding:"4px 8px",boxShadow:"0 2px 6px rgba(0,0,0,0.3)",display:"flex",alignItems:"center",gap:"4px",fontWeight:500},children:[(0,r.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"#5f6368",children:(0,r.jsx)("path",{d:"M18.92 5.01C18.72 4.42 18.16 4 17.5 4h-11c-.66 0-1.23.42-1.43 1.01L3 11v7c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h10v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-7l-1.08-5.99zM6.85 6h10.29l1.04 3H5.81l1.04-3zM5 16v-3h14v3H5z"})}),(0,r.jsxs)("span",{children:[o.totalTimeMinutes," min"]})]}),(0,r.jsx)("div",{style:{width:0,height:0,margin:"0 auto",borderLeft:"6px solid transparent",borderRight:"6px solid transparent",borderTop:"6px solid #fff",boxShadow:"0 2px 6px rgba(0,0,0,0.3)"}})]},"label-".concat(t)):null})})},N=()=>{let[e,t]=(0,l.useState)(!1);return(0,r.jsxs)("label",{className:"inline-flex items-center cursor-pointer mt-3 mx-auto",children:[(0,r.jsx)("input",{type:"checkbox",checked:e,onChange:()=>t(e=>!e),className:"sr-only"}),(0,r.jsx)("div",{className:"relative w-12 h-6 rounded-full transition-colors ".concat(e?"bg-blue-600":"bg-gray-300"),children:(0,r.jsx)("div",{className:"absolute top-0.5 left-0.5 w-5 h-5 bg-white rounded-full transition-transform ".concat(e?"translate-x-6":"")})})]})},R=()=>{let[e,t]=(0,l.useState)(!1);return(0,r.jsx)("button",{onClick:()=>t(!0),className:"mt-2 px-4 py-2 bg-blue-600 text-white font-semibold rounded-md shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:e?"Confirmed!":"Confirm & Continue"})},z=e=>{let{step:t,onNext:n,onBack:o,onSkip:l,onFinish:i}=e,s=[{title:"Welcome",content:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{style:{margin:"0 0 12px"},children:"We'll guide you through a few quick route choices."}),(0,r.jsxs)("p",{style:{margin:0},children:["Each scenario compares a ",(0,r.jsx)("strong",{children:"default"})," path with an alternative. Pick the route you'd take today."]})]})},{title:"Compare routes",content:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{style:{margin:"0 0 12px",fontSize:"1rem"},children:"Use this switch in the panel to preview the alternative route before deciding:"}),(0,r.jsx)(N,{})]})},{title:"Submit",content:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{style:{margin:"0 0 12px",fontSize:"1rem",color:"#1452EE",fontWeight:500},children:"Use the button below to confirm your choice:"}),(0,r.jsx)(R,{})]})}],a=t===s.length-1;return(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.7)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",color:"#333",fontFamily:"system-ui, sans-serif"},children:(0,r.jsxs)("div",{style:{backgroundColor:"#fff",maxWidth:"480px",width:"100%",borderRadius:"12px",padding:"24px",boxShadow:"0 8px 24px rgba(0,0,0,0.2)",textAlign:"center"},children:[(0,r.jsx)("h2",{style:{marginTop:0,marginBottom:"16px",fontSize:"1.5rem",fontWeight:600},children:s[t].title}),(0,r.jsx)("div",{style:{marginBottom:"24px",lineHeight:1.6,fontSize:"1rem"},children:s[t].content}),(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("button",{onClick:l,style:{background:"none",border:"none",color:"#666",cursor:"pointer",fontSize:"14px",textDecoration:"underline"},children:"Skip"}),(0,r.jsxs)("div",{children:[t>0&&(0,r.jsx)("button",{onClick:o,style:{padding:"8px 12px",marginRight:"10px",backgroundColor:"#eee",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Back"}),(0,r.jsx)("button",{onClick:a?i:n,style:{padding:"8px 16px",backgroundColor:"#1452EE",color:"#fff",border:"none",borderRadius:"6px",fontWeight:"bold",cursor:"pointer"},children:a?"Start":"Next"})]})]})]})})},T=e=>{let{consentText:t,checkboxChecked:n,setCheckboxChecked:o,onSubmit:i}=e,s=(0,l.useRef)(null),[a,u]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{if(s.current){let{scrollHeight:e,clientHeight:t}=s.current;e<=t&&u(!0)}},[t]),(0,r.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.7)",zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,r.jsxs)("div",{style:{backgroundColor:"#fff",width:"90%",maxWidth:"600px",maxHeight:"80vh",borderRadius:"10px",padding:"20px",overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 4px 20px rgba(0,0,0,0.3)"},children:[(0,r.jsx)("h2",{children:"Consent Form"}),(0,r.jsx)("div",{ref:s,onScroll:e=>{let{scrollTop:t,scrollHeight:n,clientHeight:o}=e.target;t+o>=n-5&&u(!0)},style:{overflowY:"auto",flex:"1 1 auto",marginBottom:"12px",border:"1px solid #ccc",borderRadius:"6px",padding:"10px"},children:null==t?void 0:t.split("\n").map((e,t)=>(0,r.jsx)("p",{children:e.trim()},t))}),(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,r.jsx)("input",{type:"checkbox",checked:n,onChange:e=>o(e.target.checked)}),"I agree to the terms and conditions."]}),(0,r.jsx)("button",{disabled:!a||!n,onClick:i,style:{marginTop:"12px",padding:"10px",backgroundColor:a&&n?"#1452EE":"#ccc",color:"#fff",border:"none",borderRadius:"6px",fontWeight:"bold",cursor:a&&n?"pointer":"not-allowed"},children:"Submit"})]})})},I=e=>{let{label:t,description:n,selectedLabel:o,onToggle:l,onSubmit:i,scenarioNumber:s,totalScenarios:a,defaultTime:u,alternativeTime:c}=e,d=o===t;return(0,r.jsxs)("div",{className:"absolute top-5 left-5 w-80 bg-white p-6 rounded-xl shadow-lg z-[1000] text-base text-gray-800 font-sans",children:[(0,r.jsxs)("p",{className:"font-semibold",children:["Scenario ",s," out of ",a]}),(0,r.jsxs)("div",{className:"mt-3 mb-6 p-4 bg-gray-100 rounded-md text-gray-700",children:[(0,r.jsxs)("p",{className:"mb-2",children:["The ",(0,r.jsx)("span",{className:"font-medium",children:"time-efficient route"})," takes approximately ",(0,r.jsxs)("span",{className:"font-medium",children:[u," minutes"]}),"."]}),(0,r.jsxs)("p",{className:"mb-2",children:["The ",(0,r.jsxs)("span",{className:"font-medium",children:[t," route"]})," prioritizes safety and takes about ",(0,r.jsxs)("span",{className:"font-medium",children:[c," minutes"]}),"."]}),(0,r.jsxs)("p",{className:"text-sm",children:["Use the toggle below to activate the ",t.toLowerCase()," route if you prefer safety over speed."]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:t}),n&&(0,r.jsx)("p",{className:"text-xs text-gray-500",children:n})]}),(0,r.jsxs)("label",{className:"inline-flex items-center cursor-pointer",children:[(0,r.jsx)("input",{type:"checkbox",checked:d,onChange:l,className:"sr-only peer"}),(0,r.jsx)("div",{className:"w-14 h-7 bg-gray-300 rounded-full relative transition-colors peer-checked:bg-blue-600 after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:w-6 after:h-6 after:bg-white after:rounded-full after:transition-transform peer-checked:after:translate-x-7"})]})]}),(0,r.jsx)("button",{onClick:i,className:"w-full py-3 px-5 bg-blue-600 text-white font-semibold rounded-md shadow hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Confirm & Continue"})]})]})},L=e=>{let{currentStep:t,totalSteps:n}=e;return(0,r.jsx)("div",{className:"absolute top-0 left-0 w-full h-2 bg-gray-200 z-[1000]",children:(0,r.jsx)("div",{className:"h-full bg-blue-600 transition-all duration-300",style:{width:"".concat((t+1)/n*100,"%")}})})},M={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},O=new Uint8Array(16),F=[];for(let e=0;e<256;++e)F.push((e+256).toString(16).slice(1));let U=function(e,t,n){if(M.randomUUID&&!t&&!e)return M.randomUUID();let r=(e=e||{}).random||(e.rng||function(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(O)})();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return F[e[t+0]]+F[e[t+1]]+F[e[t+2]]+F[e[t+3]]+"-"+F[e[t+4]]+F[e[t+5]]+"-"+F[e[t+6]]+F[e[t+7]]+"-"+F[e[t+8]]+F[e[t+9]]+"-"+F[e[t+10]]+F[e[t+11]]+F[e[t+12]]+F[e[t+13]]+F[e[t+14]]+F[e[t+15]]}(r)};var B=n(7260);let W=()=>{var e;let[t,n]=(0,l.useState)(null),[o,i]=(0,l.useState)(!1),[s,a]=(0,l.useState)(!1),[u,f]=(0,l.useState)(!1),[p,h]=(0,l.useState)(0),[m,x]=(0,l.useState)([]),[g,b]=(0,l.useState)([]),[v,j]=(0,l.useState)([]),[w,C]=(0,l.useState)(0),[S,N]=(0,l.useState)("default"),[R,M]=(0,l.useState)(null),[O]=(0,l.useState)(U());(0,l.useEffect)(()=>{localStorage.setItem("sessionId",O)},[O]);let F=(0,B.useRouter)();(0,l.useEffect)(()=>{fetch("http://localhost:5000/api/route-endpoints").then(e=>e.json()).then(e=>{n(e),j(W(e))}).catch(e=>{console.error("Failed to load route config:",e),M("Failed to load route configuration. Please try again later.")})},[]);let W=e=>{let t=e.routes.default.totalTimeMinutes,n=[];for(let[o,r]of Object.entries(e.routes))if("default"!==o)for(let e of r.variants||[])for(let r of e.tts)n.push({label:"".concat(o),routeName:o,middle:e.middle,tts:r,totalTimeMinutes:t+r});return n.sort(()=>Math.random()-.5).slice(0,e.numberOfScenarios)},A=async e=>{let n=v[w],o=t.routes.default.totalTimeMinutes;try{await fetch("http://localhost:5000/api/log-choice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:O,scenarioIndex:w,choice:e,tts:n.tts,defaultTime:o})}),w+1>=v.length?F.push("/thank-you"):(C(e=>e+1),N("default"))}catch(e){console.error("Error sending choice:",e),alert("Failed to log choice. Please try again.")}},{start:H,end:D,routes:P,consentText:Z}=t||{},_=v[w],V=null==P||null==(e=P.default)?void 0:e.totalTimeMinutes,q=(0,l.useMemo)(()=>{if(!H||!D)return null;let e=[H,D];return(null==_?void 0:_.middle)&&e.push(_.middle),c().latLngBounds(e)},[H,D,_]);return R?(0,r.jsx)("div",{children:R}):t&&0!==v.length&&q?(0,r.jsxs)("div",{style:{position:"relative",width:"100vw",height:"100vh"},children:[o&&!u&&(0,r.jsx)(L,{currentStep:w,totalSteps:v.length}),(0,r.jsxs)(d,{bounds:q,boundsOptions:{padding:[50,50],maxZoom:15},style:{height:"100%",width:"100%"},scrollWheelZoom:!1,doubleClickZoom:!1,touchZoom:!1,boxZoom:!1,keyboard:!1,zoomControl:!1,children:[(0,r.jsx)(y,{attribution:'\xa9 <a href="https://carto.com/">CARTO</a>',url:"https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png"}),(0,r.jsx)(k,{from:H,to:D,middle:_.middle,totalTimeMinutes:_.totalTimeMinutes,defaultTimeMinutes:V,selectedLabel:S,setSelectedLabel:N,consentGiven:o,setMapPoints:x,setRoutes:b,scenarioLabel:_.label})]}),o&&(0,r.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:400},children:(0,r.jsx)(E,{mapPoints:m,routes:g})}),!o&&(0,r.jsx)(T,{consentText:Z,checkboxChecked:s,setCheckboxChecked:a,onSubmit:()=>{i(!0),f(!0)}}),u&&(0,r.jsx)(z,{step:p,onNext:()=>h(e=>e+1),onBack:()=>h(e=>e-1),onSkip:()=>{f(!1),h(0)},onFinish:()=>{f(!1),h(0)}}),o&&!u&&(0,r.jsx)(I,{label:_.label,description:P[_.routeName].description,selectedLabel:S,onToggle:()=>N(S===_.label?"default":_.label),onSubmit:()=>A(S),scenarioNumber:w+1,totalScenarios:v.length,defaultTime:V,alternativeTime:_.totalTimeMinutes})]}):(0,r.jsx)("div",{children:"Loading route data..."})}}}]);